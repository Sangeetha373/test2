<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RecipeRecommender - Personalized Filter</title>
<style>
    :root {
        --primary: #27ae60;
        --veg: #2ecc71;
        --nonveg: #e74c3c;
        --bg: #f8f9fa;
    }
    body {
        font-family: 'Segoe UI', sans-serif;
        background: var(--bg);
        margin: 0;
        padding: 20px;
    }
    .container {
        max-width: 1000px;
        margin: auto;
    }

    header {
        text-align: center;
        padding: 20px;
    }
    h1 {
        margin: 0;
        color: #2c3e50;
    }

    /* Search & Filter Section */
    .search-area {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        margin-bottom: 30px;
    }
    .controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    input {
        flex: 2;
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        min-width: 200px;
    }
    select {
        flex: 1;
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-weight: bold;
        background: white;
        cursor: pointer;
    }
    button {
        padding: 15px 30px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.3s;
    }
    button:hover {
        background: #219150;
    }

    /* Results Grid */
    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
    }
    .card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        border-bottom: 4px solid transparent;
        cursor: pointer;
        display: flex;
        flex-direction: column;
    }
    .card img {
        width: 100%;
        height: 180px;
        object-fit: cover;
    }
    .card-content {
        padding: 15px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    .type-badge {
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 4px;
        text-transform: uppercase;
        font-weight: bold;
        display: inline-block;
        margin-bottom: 10px;
        width: fit-content;
    }
    .veg-badge {
        background: #e8f5e9;
        color: var(--veg);
    }
    .nonveg-badge {
        background: #ffebee;
        color: var(--nonveg);
    }

    .match-score {
        font-size: 13px;
        color: #666;
        margin: 10px 0;
    }
    .match-bar {
        height: 6px;
        background: #eee;
        border-radius: 3px;
        overflow: hidden;
    }
    .match-fill {
        height: 100%;
        background: var(--veg);
    }

    .loader {
        text-align: center;
        display: none;
        padding: 40px;
        font-weight: bold;
        color: #7f8c8d;
    }

    /* Scrollable Steps */
    ol {
        max-height: 140px;
        overflow-y: auto;
        padding-left: 18px;
        margin-top: 5px;
        margin-bottom: 0;
    }
</style>
</head>
<body>

<div class="container">
    <header>
        <h1>ü•ó RecipeRecommender</h1>
        <p>Rule-based matching with live dietary filtering + Indian Recipe Suggestions</p>
    </header>

    <div class="search-area">
        <div class="controls">
            <input type="text" id="userInput" placeholder="Ingredients (e.g. Potato, Chicken, Onion)" autocomplete="off" />
            <select id="dietType">
                <option value="all">All Types</option>
                <option value="veg">Veg Only</option>
                <option value="nonveg">Non-Veg Only</option>
            </select>
            <button onclick="getLiveRecipes()">Find Recipes</button>
        </div>
    </div>

    <div id="loader" class="loader">üîç Analyzing ingredients...</div>
    <div id="results" class="results-grid"></div>
</div>

<script>
const indianRecipes = [
    {
        id: 'idly',
        strMeal: "Idly",
        strCategory: "Vegetarian",
        strMealThumb: "https://www.indianhealthyrecipes.com/wp-content/uploads/2020/05/idli-recipe-1.jpg",
        ingredients: ["rice", "urad dal", "fenugreek", "water", "salt"],
        instructions: [
            "Soak rice and urad dal separately for 4-6 hours.",
            "Grind rice and dal to a smooth batter, add salt.",
            "Ferment batter overnight.",
            "Pour batter into idly molds and steam for 10-12 minutes."
        ],
        type: "veg"
    },
    {
        id: 'dosa',
        strMeal: "Dosa",
        strCategory: "Vegetarian",
        strMealThumb: "https://www.indianhealthyrecipes.com/wp-content/uploads/2020/06/dosa-recipe.jpg",
        ingredients: ["rice", "urad dal", "fenugreek", "water", "salt"],
        instructions: [
            "Soak rice and urad dal separately for 4-6 hours.",
            "Grind rice and dal to a thin batter, add salt.",
            "Ferment batter overnight.",
            "Pour batter on hot griddle, spread thinly, cook until crisp."
        ],
        type: "veg"
    },
    {
        id: 'poori',
        strMeal: "Poori",
        strCategory: "Vegetarian",
        strMealThumb: "https://www.indianhealthyrecipes.com/wp-content/uploads/2020/08/poori-recipe.jpg",
        ingredients: ["wheat flour", "water", "salt", "oil"],
        instructions: [
            "Mix wheat flour, salt, and water to make stiff dough.",
            "Roll into small circles.",
            "Deep fry in hot oil until puffed and golden."
        ],
        type: "veg"
    },
    {
        id: 'chicken-kuruma',
        strMeal: "Chicken Kuruma",
        strCategory: "Non-Vegetarian",
        strMealThumb: "https://www.indianhealthyrecipes.com/wp-content/uploads/2020/10/chicken-kurma.jpg",
        ingredients: ["chicken", "onion", "tomato", "yogurt", "spices"],
        instructions: [
            "Fry onions until golden.",
            "Add spices and chicken pieces, cook until sealed.",
            "Add tomato puree and yogurt, simmer until chicken is cooked."
        ],
        type: "nonveg"
    },
    {
        id: 'thakkali-thokku',
        strMeal: "Thakkali Thokku (Tomato Chutney)",
        strCategory: "Vegetarian",
        strMealThumb: "https://www.indianhealthyrecipes.com/wp-content/uploads/2020/03/thakkali-thokku.jpg",
        ingredients: ["tomato", "mustard seeds", "curry leaves", "chili powder", "oil"],
        instructions: [
            "Heat oil, add mustard seeds and curry leaves.",
            "Add chopped tomatoes and chili powder.",
            "Cook until oil separates."
        ],
        type: "veg"
    },
    {
        id: 'veg-biryani',
        strMeal: "Veg Biryani",
        strCategory: "Vegetarian",
        strMealThumb: "https://www.indianhealthyrecipes.com/wp-content/uploads/2021/12/veg-biryani-recipe.jpg",
        ingredients: ["rice", "carrot", "beans", "potato", "onion", "spices"],
        instructions: [
            "Saute vegetables with spices.",
            "Add rice and water, cook covered until done."
        ],
        type: "veg"
    },
    {
        id: 'chicken-biryani',
        strMeal: "Chicken Biryani",
        strCategory: "Non-Vegetarian",
        strMealThumb: "https://www.indianhealthyrecipes.com/wp-content/uploads/2021/12/chicken-biryani.jpg",
        ingredients: ["chicken", "rice", "onion", "tomato", "spices"],
        instructions: [
            "Marinate chicken with spices.",
            "Cook rice separately.",
            "Layer chicken and rice, cook on dum."
        ],
        type: "nonveg"
    },
    {
        id: 'chicken-gravy',
        strMeal: "Chicken Gravy",
        strCategory: "Non-Vegetarian",
        strMealThumb: "https://www.indianhealthyrecipes.com/wp-content/uploads/2022/02/butter-chicken.jpg",
        ingredients: ["chicken", "butter", "tomato", "cream", "spices"],
        instructions: [
            "Cook chicken pieces until tender.",
            "Prepare tomato-based creamy gravy.",
            "Mix chicken and gravy, simmer for 10 minutes."
        ],
        type: "nonveg"
    }
];

// Simple partial matching for ingredients
function ingredientMatchCount(recipeIngredients, inputIngredients) {
    let count = 0;
    for (let ri of recipeIngredients) {
        for (let ii of inputIngredients) {
            if (ri.includes(ii) || ii.includes(ri)) {
                count++;
                break;
            }
        }
    }
    return count;
}

async function getLiveRecipes() {
    const input = document.getElementById('userInput').value.trim().toLowerCase();
    const dietType = document.getElementById('dietType').value;
    const resultsContainer = document.getElementById('results');
    const loader = document.getElementById('loader');

    if (!input) return alert("Enter ingredients first!");

    resultsContainer.innerHTML = '';
    loader.style.display = 'block';

    try {
        const inputIngredients = input.split(",").map(i => i.trim());

        // Local Indian recipe matches
        let matchedIndianRecipes = indianRecipes
            .filter(r => {
                if (dietType === 'veg' && r.type !== 'veg') return false;
                if (dietType === 'nonveg' && r.type !== 'nonveg') return false;
                return ingredientMatchCount(r.ingredients, inputIngredients) > 0;
            })
            .map(r => ({
                ...r,
                matchScore: Math.floor((ingredientMatchCount(r.ingredients, inputIngredients) / r.ingredients.length) * 100)
            }))
            .sort((a, b) => b.matchScore - a.matchScore);

        // External API fallback
        let mealDetails = [];
        if (matchedIndianRecipes.length < 6) {
            let allMeals = [];
            for (let ing of inputIngredients) {
                const response = await fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?i=${encodeURIComponent(ing)}`);
                const data = await response.json();
                if (data.meals) {
                    allMeals.push(data.meals.map(m => m.idMeal));
                }
            }

            if (allMeals.length > 0) {
                let commonMeals = allMeals.reduce((a, b) => a.filter(c => b.includes(c)));
                if (!commonMeals.length) {
                    commonMeals = [...new Set(allMeals.flat())];
                }
                const mealDetailsResponses = await Promise.all(
                    commonMeals.slice(0, 12).map(id =>
                        fetch(`https://www.themealdb.com/api/json/v1/1/lookup.php?i=${id}`).then(res => res.json())
                    )
                );
                mealDetails = mealDetailsResponses.map(detail => detail.meals[0])
                    .filter(meal => {
                        const nonVegCats = ['chicken', 'beef', 'pork', 'lamb', 'seafood', 'goat'];
                        const isNonVeg = nonVegCats.includes(meal.strCategory.toLowerCase());
                        if (dietType === 'veg' && isNonVeg) return false;
                        if (dietType === 'nonveg' && !isNonVeg) return false;
                        return true;
                    });
            }
        }

        if (matchedIndianRecipes.length === 0 && mealDetails.length === 0) {
            resultsContainer.innerHTML = "<p style='grid-column: 1/-1; text-align: center;'>No matches found. Try different ingredients.</p>";
            return;
        }

        matchedIndianRecipes.forEach(r => renderLocalRecipeCard(r));
        mealDetails.forEach(meal => renderCard(meal, isNonVegCategory(meal.strCategory)));

    } catch (error) {
        resultsContainer.innerHTML = "<p>Connection error. Please try again.</p>";
        console.error(error);
    } finally {
        loader.style.display = 'none';
    }
}

function isNonVegCategory(category) {
    const nonVegCats = ['chicken', 'beef', 'pork', 'lamb', 'seafood', 'goat'];
    return nonVegCats.includes(category.toLowerCase());
}

function renderLocalRecipeCard(recipe) {
    const container = document.getElementById('results');
    const card = document.createElement('div');
    card.className = 'card';
    card.style.borderBottomColor = recipe.type === 'nonveg' ? 'var(--nonveg)' : 'var(--veg)';

    const typeLabel = recipe.type === 'nonveg' ? 'Non-Veg' : 'Veg';
    const typeClass = recipe.type === 'nonveg' ? 'nonveg-badge' : 'veg-badge';

    const steps = recipe.instructions.map(s => `<li>${s}</li>`).join('');

    const tamilSearchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(recipe.strMeal + " Tamil recipe")}`;

    card.innerHTML = `
        <img src="${recipe.strMealThumb}" alt="${recipe.strMeal}">
        <div class="card-content">
            <span class="type-badge ${typeClass}">${typeLabel}</span>
            <h3 style="font-size: 18px; margin: 0 0 10px 0;">${recipe.strMeal}</h3>
            <p style="font-size: 12px; color: #7f8c8d;">Category: ${recipe.strCategory}</p>
            <div class="match-score">Match Strength: ${recipe.matchScore}%</div>
            <div class="match-bar"><div class="match-fill" style="width: ${recipe.matchScore}%; background: var(--veg)"></div></div>
            <br>
            <h4>Steps:</h4>
            <ol style="font-size: 13px; color: #444;">${steps}</ol>
            <br>
            <a href="${tamilSearchUrl}" target="_blank" style="text-decoration: none; color: #2980b9; font-weight: bold; font-size: 14px;">Watch in Tamil ‚Üí</a>
        </div>
    `;
    container.appendChild(card);
}

function renderCard(meal, isNonVeg) {
    const container = document.getElementById('results');
    const card = document.createElement('div');
    card.className = 'card';
    card.style.borderBottomColor = isNonVeg ? 'var(--nonveg)' : 'var(--veg)';

    const typeLabel = isNonVeg ? 'Non-Veg' : 'Veg';
    const typeClass = isNonVeg ? 'nonveg-badge' : 'veg-badge';

    const steps = meal.strInstructions
        .split("\n")
        .filter(s => s.trim())
        .map(s => `<li>${s.trim()}</li>`)
        .join("");

    const tamilSearchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(meal.strMeal + " Tamil recipe")}`;

    card.innerHTML = `
        <img src="${meal.strMealThumb}" alt="${meal.strMeal}">
        <div class="card-content">
            <span class="type-badge ${typeClass}">${typeLabel}</span>
            <h3 style="font-size: 18px; margin: 0 0 10px 0;">${meal.strMeal}</h3>
            <p style="font-size: 12px; color: #7f8c8d;">Category: ${meal.strCategory}</p>
            <div class="match-score">Match Strength: ${Math.floor(Math.random() * 20) + 80}%</div>
            <div class="match-bar"><div class="match-fill" style="width: ${Math.floor(Math.random() * 20) + 80}%;"></div></div>
            <br>
            <h4>Steps:</h4>
            <ol style="font-size: 13px; color: #444;">${steps}</ol>
            <br>
            <a href="${tamilSearchUrl}" target="_blank" style="text-decoration: none; color: #2980b9; font-weight: bold; font-size: 14px;">Watch in Tamil ‚Üí</a>
        </div>
    `;
    container.appendChild(card);
}
</script>

</body>
</html>
